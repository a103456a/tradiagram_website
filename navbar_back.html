<!-- 功能表 -->
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand" href="#">目錄</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="./"><span class="glyphicon glyphicon-home"></span> Home</a></li>
		<li class="dropdown">
			<a class="dropdown-toggle" data-toggle="dropdown" href="#">西部幹線<span class="caret"></span></a>
			<ul class="dropdown-menu">
				<li><a href = 'lines.php?lineKind=west_link_north'>北段</a></li>
				<li><a href = 'lines.php?lineKind=west_link_south'>南段</a></li>
				<li><a href = 'lines.php?lineKind=west_link_moutain'>山線</a></li>
				<li><a href = 'lines.php?lineKind=west_link_sea'>海線</a></li>
			</ul>
        </li>
		<li><a href = 'lines.php?lineKind=pingtung'>屏東線</a></li>
		<li><a href = 'lines.php?lineKind=south_link'>南迴線</a></li>
		<li><a href = 'lines.php?lineKind=taitung'>台東線</a></li>
		<li><a href = 'lines.php?lineKind=yilan'>宜蘭線(修正中)</a></li>
		<li class="dropdown">
			<a class="dropdown-toggle" data-toggle="dropdown" href="#">支線<span class="caret"></span></a>
			<ul class="dropdown-menu">
				<li><a href = 'lines.php?lineKind=pingxi'>平溪深澳線</a></li>
				<li><a href = 'lines.php?lineKind=neiwan'>內灣線</a></li>
				<li><a href = 'lines.php?lineKind=jiji'>集集線</a></li>
				<li><a href = 'lines.php?lineKind=shalun'>沙崙線</a></li>
			</ul>
        </li>
		<li><a href = 'special_use.php?'>特殊運用</a></li>
		<li><a href = 'https://www.facebook.com/traDiagram/'>facebook</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
		<li><a href='http://tradiagram.com/timetable.php'><span class="glyphicon glyphicon-warning-sign"></span> 時刻表查詢測試</a></li>
		<li><a data-toggle="modal" href="#form-content"><span class="glyphicon glyphicon-warning-sign"></span> 時刻表查詢測試1</a></li>
	    <li><a href='about.php'><span class="glyphicon glyphicon-info-sign"></span> 說明</a></li>
        <li><a href='mailto:sc91@tcust.edu.tw'><span class="glyphicon glyphicon-envelope"></span> 聯絡我們</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- 查詢火車時刻表單 modal -->
<div id="form-content" class="modal fade">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				  <a class="close" data-dismiss="modal">×</a>
				  <h3>台鐵時刻表查詢</h3>
			</div>
			<div>
				<form class="contact">
				<fieldset>
					<div class="modal-body">
						<ul class="nav nav-list">
							<li class="nav-header">起站：</li>
							<li>
								<select class="form-control" id="sel1">
									<option value="0">請選擇</option>
									<option value="1">台北地區</option>
									<option value="2">桃園地區</option>
									<option value="3">新竹地區</option>
									<option value="4">苗栗地區</option>
									<option value="5">台中地區</option>
									<option value="6">彰化地區</option>
									<option value="7">雲林地區</option>
									<option value="8">嘉義地區</option>
									<option value="9">台南地區</option>
									<option value="10">高雄地區</option>
									<option value="11">屏東地區</option>
									<option value="12">台東地區</option>
									<option value="13">花蓮地區</option>
									<option value="14">宜蘭地區</option>
									<option value="15">內灣線</option>
									<option value="16">集集線</option>
									<option value="17">沙崙線</option>
									<option value="18">平溪線</option>
								</select>
								<select class="form-control" id="sel2" name="start_station"></select>
							</li>
							<li class="nav-header">終站：</li>
							<li>
								<select class="form-control" id="sel3">
									<option value="0">請選擇</option>
									<option value="1">台北地區</option>
									<option value="2">桃園地區</option>
									<option value="3">新竹地區</option>
									<option value="4">苗栗地區</option>
									<option value="5">台中地區</option>
									<option value="6">彰化地區</option>
									<option value="7">雲林地區</option>
									<option value="8">嘉義地區</option>
									<option value="9">台南地區</option>
									<option value="10">高雄地區</option>
									<option value="11">屏東地區</option>
									<option value="12">台東地區</option>
									<option value="13">花蓮地區</option>
									<option value="14">宜蘭地區</option>
									<option value="15">內灣線</option>
									<option value="16">集集線</option>
									<option value="17">沙崙線</option>
									<option value="18">平溪線</option>
								</select>
								<select class="form-control" id="sel4" name="end_station"></select>
							</li>
							<li class="nav-header">時間</li>
							<li>
								<select class="form-control" id="time" name="time"></select>
							</li>
							<li class="nav-header">車種</li>
							<li>
								<select class="form-control" name="car_class">
									<option value="all">所有車種</option>
									<option value="seat">對號列車</option>
									<option value="noseat">非對號列車</option>
									<option value="tzu_chiang">自強號</option>
									<option value="puyuma_taroko">普悠瑪與太魯閣</option>
									<option value="chu_kuang">莒光號</option>
									<option value="puxing_ordinary">復興號與普快車</option>
									<option value="local">區間車</option>
								</select>
							</li>
						</ul>
					</div>
				</fieldset>
				</form>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" data-dismiss="modal">關閉</button>
				<button class="btn btn-primary" id="submit">送出</button>
				 
			</div>
		</div>
	</div>
</div>

<script>

function padLeft(str, len) {
    str = '' + str;
    if (str.length >= len) {
        return str;
    } else {
        return padLeft("0" + str, len);
    }
}

$(document).ready(function() {
	for(i=0; i<25; i++){
		$("#time").append($("<option value= '" + padLeft(i, 2) + "00'>" + padLeft(i, 2) + ":00" + "</option>"));
	}
});

 $(function() {
//twitter bootstrap script
	$("button#submit").click(function(){
		   	$.ajax({
    		   	type: "GET",
			url: "timetable/query_modal.php",
			data: $('form.contact').serialize(),
        		success: function(msg){
 	          		$("#thanks").html(msg)
 		        	$("#form-content").modal('hide');	
 		        },
			error: function(){
				alert("failure");
				}
      			});
	});
});

$("#sel1").change(function(){

	var select = parseInt($(this).val());

	$("#sel2 option").remove();
	
	if (select != 0){
		$.ajax({
		url: "/timetable/stations.json",
		cache: true,
		dataType: "json",
		type: "GET",
		success: function(results){
			//console.log("ready!");
			console.log(results);
			var i = 0;
			
			$.each(results, function(key, value) {
				if (results[i].EXTRA3 == select){
					$("#sel2").append($("<option value='" + results[i].ID + "'>" + results[i].DSC + "</option>"));
					
				}
			i++;
					
			// $.each(results[select].STATIONS, function(key, value) {
				// $("#sel2").append($("<option value='" + value.ID + "'>" +value.DSC + "</option>"));
				// $("#JSON_table").append("<tr>" +
									  // "<td>" + value.ID + "</td>" +
									  // "<td>" + value.DSC + "</td>" +
									  // //"<td>" + results[0].STATIONS[i].DSC + "</td>" +
									  // //"<td>" + results[i].ID + "</td>" +
									  // "</tr>");
				// i++;
			});
		},
		error: function (xhr, ajaxOptions, thrownError) {
					alert(xhr.status);
					alert(thrownError);
				}
		});	
	}
});

$("#sel3").change(function(){

	var select = parseInt($(this).val());

	$("#sel4 option").remove();
	
	if (select != 0){
		$.ajax({
		url: "/timetable/stations.json",
		cache: true,
		dataType: "json",
		type: "GET",
		success: function(results){
			//console.log("ready!");
			console.log(results);
			var i = 0;
			
			$.each(results, function(key, value) {
				if (results[i].EXTRA3 == select){
					$("#sel4").append($("<option value='" + results[i].ID + "'>" + results[i].DSC + "</option>"));
					
				}
			i++;
					
			// $.each(results[select].STATIONS, function(key, value) {
				// $("#sel2").append($("<option value='" + value.ID + "'>" +value.DSC + "</option>"));
				// $("#JSON_table").append("<tr>" +
									  // "<td>" + value.ID + "</td>" +
									  // "<td>" + value.DSC + "</td>" +
									  // //"<td>" + results[0].STATIONS[i].DSC + "</td>" +
									  // //"<td>" + results[i].ID + "</td>" +
									  // "</tr>");
				// i++;
			});
		},
		error: function (xhr, ajaxOptions, thrownError) {
					alert(xhr.status);
					alert(thrownError);
				}
		});
	}
});


</script>
